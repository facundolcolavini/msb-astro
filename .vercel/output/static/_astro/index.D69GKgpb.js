let t=[],o=(r,i)=>{let u=[],l={get(){return l.lc||l.listen(()=>{})(),l.value},l:i||0,lc:0,listen(n,f){return l.lc=u.push(n,f||l.l)/2,()=>{let e=u.indexOf(n);~e&&(u.splice(e,2),--l.lc||l.off())}},notify(n){let f=!t.length;for(let e=0;e<u.length;e+=2)t.push(u[e],u[e+1],l.value,n);if(f){for(let e=0;e<t.length;e+=4){let s;for(let a=e+1;!s&&(a+=4)<t.length;)t[a]<t[e+1]&&(s=t.push(t[e],t[e+1],t[e+2],t[e+3]));s||t[e](t[e+2],t[e+3])}t.length=0}},off(){},set(n){l.value!==n&&(l.value=n,l.notify())},subscribe(n,f){let e=l.listen(n,f);return n(l.value),e},value:r};return l},v=(r={})=>{let i=o(r);return i.setKey=function(u,l){typeof l>"u"?u in i.value&&(i.value={...i.value},delete i.value[u],i.notify(u)):i.value[u]!==l&&(i.value={...i.value,[u]:l},i.notify(u))},i};export{o as a,v as m};
