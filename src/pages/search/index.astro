---
import Pagination from "../../components/Pagination.astro";
import Layout from "../../layouts/Layout.astro";
import SearchLayout from "../../layouts/SearchLayout.astro";
import { getResultsRecords } from "../../services/get-results-records";
import { getAllSelects } from "../../services/get-selects-form";
import type { Result } from "../../types/results.records.types";
import type { Results } from "../../types/selects.form.types";
import { parseQueryToObjt } from "../../utils/querys-format";

const selects = (await getAllSelects()) as Results;
const {search} = Astro.url


let searchData; 

// sacar el ? del url.search y convertirlo en un objeto 
const queryObj = parseQueryToObjt(search.slice(1, search.length))

// Fetch search data
if (queryObj) {
    console.log(queryObj,'queryObj')
    searchData = await getResultsRecords( queryObj);
}else{
    searchData = await getResultsRecords();
}

---


<Layout  title="Busqueda">
    <SearchLayout selects={selects} list={searchData as Result} />
    <Pagination datos={searchData.datos} />
</Layout>
